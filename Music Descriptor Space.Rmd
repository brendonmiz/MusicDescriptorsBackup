---
title             : "Cognitive Music Listening Space: A Multivariate Approach"
shorttitle        : "Music Descriptor Space"

author: 
  - name          : "Brendon Mizener"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "800 W. Campbell Rd., Richardson Tex"
    email         : "bmizener@utdallas.edu"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - Stimuli creation
      - Survey design & creation
      - Data collection & processing
      - Statistical analyses
      - Writing - Original draft preparation
  - name          : "Mathilde Vandenberghe"
    affiliation   : "2"
    role:
      - Original concept
      - Survey design & creation
  - name          : "Herve Abdi"
    affiliation   : "1"
    role:
      - Writing - Review & Editing
      - Statistical guidance
  - name          : "Sylvie Chollet"
    affiliation   : "2"
    role:
      - Original concept

affiliation:
  - id            : "1"
    institution   : "University of Texas at Dallas"
  - id            : "2"
    institution   : "YNCREA"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  This is my abstract
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
csl               : "apa7.csl"
classoption       : "man"
output            : papaja::apa6_pdf
header-includes   :
          - \usepackage{caption}

---

```{r setup, include = FALSE}
# Seed for random number generation
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message=FALSE, fig.align = "center",cache.extra = knitr::rand_seed)
set.seed(42)

papaja::r_refs("r-references.bib")
```

```{r analysis-preferences}
library("papaja")
suppressMessages(library(ExPosition))
suppressMessages(library(InPosition))
library(PTCA4CATA)
library(purrr)
library(plyr)
library(tidyverse)
library(readxl)
library(stringr)
library(stringi)
library(rlist)
library(wesanderson)
#library(kableExtra)
library(ggplotify)
library(gridExtra)
library(grid)
library(abind)

```

```{r citations, eval = FALSE, echo=FALSE, include=FALSE}




```
#top
  Music listening is a complex cognitive activity that involves many judgments per second. Listeners continuously evaluate incoming information and compare it with that which came before. These judgments involve many different dimensions of music related to both the technical and affective aspects of this acoustic medium. While the technical and affective aspects of music are theoretically distinct, in practice there is a great deal of back and forth between the two. Listeners respond affectively to technical aspects of music, and composers use those technical things to induce affect in listeners. Assessing the interplay between the two is quite a task, because it's difficult to isolate specifically which musical mechanisms affect listeners in specific ways, to say nothing of the individual associations that participants bring to the table. One way to minimize the individual associations is to use novel music, but that requires controlling for familiarity. In a musically trained population, the easiest way to do that is to compose novel music, so we composed 30 novel stimuli for this specific study.  
  Research into the emotion of music, specifically, is a well-trod topic [cite that book here(Juslin&Sloboda)]. A review of the literature surrounding music perception quickly reveals a number of issues. Firstly, the participants in these experiments are largely WEIRD (Western, Educated, Industrialized, Rich, and Democratic). The participant pool becomes even smaller when you realize that researchers use students in their departments as participants, either psychology or music, or in some cases marketing or business. This practice inherently biases the sample towards the ethnic majority, as representation and access to higher education remains an issue. 
  In terms of stimuli, although there is a database of over 20000 previously used musical excerpts [@Warrenburg2020], the vast majority of those are either western or popular music. These stimuli are also often presented under strict laboratory control, which we respectfully submit does not reflect an ecologically valid process for listening. Also, specifically asking the participants to evaluate 'arousal' and 'valence' using a slider is useful, but limiting. It achieves a high level of granularity with regard to the level of arousal or valence a given stimulus provides, but does not qualify it in any way. Similarly, studies that ask participants to cluster stimuli depend on greater levels of interpolation from the researchers in determining affective impact. Fewer studies have used adjectives to evaluate music holistically (examples include @Wedin1969, @Wedin1972, @Hevner1936, @Canazza2001], and of those not all used multivariate analyses.  
  Other studies exist that evaluate how various technical aspects of music correspond to emotions for the purpose of induction, (see @Bruner1990 for an early summary) but the musical characteristics don't accurately capture the full dimensionality that composers consider when writing music. Also, many of the studies that investigate from this perspective impose strict limitations on how the stimuli vary, which is useful for illuminating very specific effects of a single musical element or characteristic, but makes it impossible to evaluate interactions between any musical variables. Assessing the interplay between the technical aspects of music and descriptive/affective requires a fine - grained approach that is able to evaluate the correlations and covariates between many dimensions simultaneously. Imaging studies that evaluate the neural response to music could be very valuable here, but they require prohibitive amounts of resources, are severely location-dependent. That being said, there are multivariate techniques that are commonly used in imaging studies that are designed for the specific purpose of what we aim with this study.
  
  Few studies using multivariate analyses to evaluate music holistically have used all four: large numbers of stimuli, large numbers of descriptors, and a large sample size, and ecologically valid musical stimuli. @Canazza2001, for example, only used a single stimulus. @Wedin1972 used a large number of stimuli (35), a large number of 'attributes' (150), but a sample size of only 49.

A recent study  

  This work should be considered 


  Research on the perception of timbre has provided some useful templates in navigating this space. @Wallmark2018 notes that because timbre is not a linear phenomenon, as tempo or pitch is, qualitative descriptors make the most sense when evaluating it. A similar conceptual framework would ideally be applied to music to be evaluated holistically. In this regard, we consider the current work to be theoretically distinct from works that specifically evaluate emotional perception in music. The present work does confirm the results of those studies thanks to the appearance of the valence-arousal plane. However, we did not intentionally use emotionally valenced adjectives when selecting the vocabulary participants used to rate stimuli. Additionally, we compare the descriptors to music-theoretical dimensions that are rated on discrete scales in order to evaluate which elements from either set of descriptors covary with one another.
  Another specific reference in the study of timbre that provides a useful comparison is @Zacharakis2014 This study addresses not only the qualitative nature of analysis, but serves as an interesting guidepost in terms of intercultural or inter-lingual music evaluation. @Zacharakis2014 found that for two different languages, meaning was largely 

  
  
  - we used correspondence analysis inste4ad of a nother form of factor or multivariate analysis, which allows for biplots. this will allow you to see not only where the adjctives lie in the factor space4, but also where the musical descriptors/quialities lie in atheir own factor space. While  the biplot specifically then allows you to plot the excerpts in the same space as the descriptors, which provides a clear, quick, visual reference for what excerpts or musical pieces fall in to what space of the cognitive space. 


 By developing investigative paradigms that are accessible on mobile platforms, and that reduce participant demand as much as possible while maintaining rigor, we are likely to be able to reach a much greater subset of the population. If we are able to pair this kind of data gathering with appropriate exploratory analysis, we can target much more effectively where we might investigate with more traditional hypothesis testing.
  The initial motivation for this paper was as precursor work to a study aimed at evaluating the cross-modal similarities between gustatory perception and auditory perception. There exist various established gustatory 'spaces' onto which music perception might be mapped, for example in wine tasting [wine citations here], the only analogous space in music listening deals specifically with emotional processing. The goal of this study was to evaluate whether or not there is a similar music perception space against which other sensory domains could be compared, and to select stimuli that could anchor the corners of such a space. 




In this study, we attempt to address three specific issues with the field as a whole: sample & size, mode of investigation, and balancing  analysis. The gradual increase in complexity of studies in behavior and cognition, coupled with the rise of questions about the universality of experience and the democratization of science, compels us to find novel ways of investigating the experience of music. 










###################
  Much of the work in music cognition focused on adjectives or descriptors has focused on timbre. [citations: Wallmark, Zacharakis] Early work attempting this: @Hevner1936a

###################
  The current study aimed to evaluate a set of musical stimuli in two ways, by association with a list of adjectives, and by rating on a set of musical qualities. These will then be analyzed independently and then combined to see what effects can be deduced from the combination of the two.

###################
  Valence/arousal model


Existing multivariate approaches: 
@Roda2014a: uses clustering, not descriptors, compares directly to physical features of music. Attempts to quantify higher dimensions
@Droit-Volet2013a: uses point-scale ratings (unpleasant/pleasant; calm/exciting) and investigates effect of time on ratings.


  - as questions become more complex, the burden on researchers to define parameters in which to test and evaluate their results becomes much greater. Controlling for extraneous variables becomes a problem in and of itself.
  - lacks generalizability because of narrowness
  - rising question of universalities & cross-cultural perception in music 
  - how do we access a larger population

  - This all results in a need for an experimental paradigm that is robust to violations in experimental procedure, accesses 

  - After cleaning and preprocessing, the data for each participant will take the form of a pseudo contingency table. The difference here is that a contingency table is specifically when a participant selects only one option from a list for each stimulus, resulting in a table with one and only one one (1) per row. Because we are using the CATA technique, a one (1) at the intersection of each row or column indicates that the participant selected that adjective or musical quality for that stimulus. A zero means that they did not. These individual tables are all compiled into a 'brick', or three-dimensional array of data with Observations (stimuli) on the rows, variables (musical qualities or adjectives) on the columns, and participants on the third dimension, which we will refer to as 'pages' here. This brick is then summed across pages into a single table, so that any given cell contains the total number of times a participant selected a given adjective or quality to match with a stimulus. 
  From this point there are two sets of data that can be analyzed. The first is the 3D array, which can be analyzed using various distance analyses, to evaluate differences between the participants using grouping variables extracted from the demographics surveys. The other is the pseudo contingency table, which can be analyzed using various multivariate techniques.
  - what processing steps are needed



## Present questions & methods of analysis
  The initial motivation for this study came from a cross-modal study investigating cross modal sensory mapping between gustation perception, specifically beer, and music perception. Prior versions of this experiment (unpublished) suggest that a wide variety in musical stimuli was necessary to determine any correlations or differences. As such, this study is designed to investigate whether a music cognitive listening space can be established using this paradigm, to allow cross-modal comparison. Additional questions arise from the study itself: are there significant differences in how participants from different nationalities (and by extension musical cultures) perceive, or, more precisely, describe music? Are there parallels in how music is evaluated using music non-specific descriptors and music-specific qualities? Because this study was designed to be exploratory in nature, we feel it would be poor scientific practice to present specific hypotheses. 

# Methods

## Participants
  Participants (N = 604) were recruited similarly for both Experiments 1 and 2, and thus are discussed simultaneously here. Participants for this study were recruited in multiple ways, all of which represent convenience sampling. The participants in the United States (n = 292) were recruited using the traditional method of offering experimental participation credit, and also via social media. French participants (n = 312) were recruited by word of mouth, email, and social media. The only restrictions on participation were that the participant must have self-reported normal hearing. We recognize that although we suggest that data collected in this way have a much greater hypothetical reach, the data here represent a) a convenience sample, b) that is limited to participants that have access to the internet. Both of these specific limitations could be remedied when designing and implementing future research.  
  The population we recruited was different for the two experiments. For Experiment 1, we specifically sought out highly trained musicians (n = 84) with ten years or more of music training. We recruited this population for two reasons: firstly, as a validation step, to ascertain whether the stimuli truly reflected the composer's intent. Secondly, we had the goal of evaluating how the musical qualities of the stimuli, as evaluated by the trained participants, correlated with the adjectives selected by those who participated in the adjectives survey. Participants were recruited for Experiment 2 (n = 520) without regard to level of music training.  
  Of the responses to Experiment 1, 51 were removed to incomplete data (nf = 45, nA = 6), leaving a total of 33 for the analysis. Of the responses to experiment 2, 160 were removed for not completing the survey (nF = 140, nA = 20), leaving a total of 360. Of the responses to the survey administered in the US, participants were excluded from analysis if they indicated a nationality other than American. "Asian-American", for example, was included, but "Ghanian" was not. This left a total of 312 participants for analysis across both experiments. 
  All recruitment measures were approved by the UT Dallas IRB.
  
## Material

### Stimuli
  All stimuli were original musical excerpts composed for this study. They were designed to evaluate a number of musical dimensions and control for others (e.g., timbre). The stimuli were all string quartets, in order to control for the confounding factor that different instruments are fundamentally described in different ways. All stimuli were between 27s and 40s long, with an average length of 32.4s. The intent was to have all stimuli be around 30s long while preserving musical integrity. All stimuli were composed between April 13 and June 18, 2020. 

### Surveys
  There were two separate surveys presented to participants. The survey used in Experiment 1 (hereafter: Qualities Survey/QS) evaluated the musical stimuli on concrete musical qualities like meter and genre. The survey used in Experiment 2 (hereafter: Adjectives Survey/AS) asked participants to evaluate the stimuli using adjectives using the CATA paradigm. Both surveys also captured participants' demographic data, including age, gender, nationality, occupation, and musical experience.  
  The qualities assessed in the QS were selected from standard music-theoretical descriptors of music. For example, when rating the excerpts on tempo, participants were asked to rate the excerpt using the scale *Very Slow*, *Slow*, *Moderately Slow*, *Moderate*, *Moderately Fast*, *Fast*, and *Very Fast*. The full list of musical qualities and associated levels is in [supplementary materials?]. The words for the AS were selected using @Wallmark2019 as a guide and in consult with a French professional musician. Some words were initially selected in French and some in English. In all cases, words were selected for which there was a clear French (vis-a-vis English) translation. The words and their translations are listed in [supplementary materials?]. 
  
## Procedure
  Participants were provided with a link to either the AS or the QS. Both surveys were administered using Qualtrics. After standard informed consent, participants listened to 15 excerpts and answered questions. Demographic survey questions followed the experimental task. Participants were instructed to listen to the excerpts presented either using headphones or in a quiet listening environment, but that was not strictly controlled, nor was it part of the survey. Participants in Experiment 1 answered 10 questions per excerpt, rating the excerpts using the qualities and scales provided. Participants in Experiment 2 answered a single question per excerpt, in which they selected any and all adjectives that they felt described the excerpt.  
  
## CATA paradigm
  While not invented by @Katz1933, the Check-All-That-Apply (CATA) investigative paradigm was used in that study to evaluate racial stereotypes among college students. As an method it's not terribly common in the psychological sciences any more, but it has been and continues to be used widely to "obtain rapid product profiles" [@Meyner2014] from participants. It is also commonly used in sensory evaluation. In this method, participants are asked to select any and all adjectives from a list that describe a given stimulus. This allows researchers to collect a lot of data about a given stimulus without placing demand on the participants. 

## Data analysis
  Raw data were cleaned and processed in Excel and R. This included translating all French responses to English for ease of analysis. Data were cleaned and transformed into a pseudo contingency table for each participant. These individual tables were all compiled into into two 'bricks', or three-dimensional arrays of data with Observations (stimuli) on the rows, variables (musical qualities or adjectives) on the columns, and participants on the third dimension, which we will refer to as 'pages' here. Each array was then summed across pages into a single summary pseudo-contingency table, so that any given cell contained the total number of times a participant selected a given adjective or quality for a given stimulus.
  The arrays were analyzed using distance analyses to evaluate differences between the participants using grouping variables extracted from the demographics surveys. The summed tables were analyzed using Correspondence Analysis. Since we did not use *a priori* grouping variables for the excerpts, the summed tables were evaluated using hierarchical cluster analyses to see what groupings arose during evaluation.
  A final analysis (Partial Least Squares Correlation, see @Abdi2013a) evaluated correlations between the two summed data tables to see what information was shared between the two tables. 
  For each of these analyses, variance is extracted in the form of eigenvalues. The individual factor scores are plotted relative to these eigenvalues, which form the axes of the maps shown below. The dimensions extracted in this process are by definition orthogonal and share no information. For the sake of efficiency, for each of the analyses below, we focus on the first two dimensions.

### Correspondence Analysis
  
  Correspondence Analysis (CA) is similar to Principal Components Analysis (PCA), except that it allows for the analysis of qualitative data. Because of the organization of the data, this technique allows for a biplot of both rows and columns in a single factor space. In addition to factor plots, we used permutation tests and bootstrapping for statistical inferences.

### Partial Least Squares Correlation

  Partial Least Squares Correlation (PLSC) analyzes two data tables either on the same observations (rows) or variables (columns). This technique is commonly used in neuroimaging studies to evaluate correlations between matrices of imaging data and of behavioral or task data [@Krishnan2011]. In this case, we are evaluating the correlation and covariance between the the stimuli, which are the observations (rows) for both data tables. 
  
# Results
## Experiment 1: Musical Qualities Survey

```{r importQualdata}

load("catadatamusdim.RData")
musdimdata <- catadata.list$contingency
numberofdims <- catadata.list$numberofdims
thebrick <- catadata.list$thebrick

rows2drop <- c(6,14) 

musdimdata.no6 <- musdimdata[-rows2drop,]
thebrick.no6 <- thebrick[-rows2drop,,]
```

```{r Q.parts}

# reorder some of the columns in the french experts dataset, 
# taking only the ones we want to analyse for now
fr.ex.data <- catadata.list$french.expert.data[c(1:3,6,7,9:12),c(1,4,5,6,7)]
colnames(fr.ex.data) <- c("age", "gen", "nat", "tr_yrs", "tr_type")
fr.ex.data$gen[which(fr.ex.data$gen == "Homme")] <- "M"
fr.ex.data$gen[which(fr.ex.data$gen == "Femme")] <- "F"
fr.ex.data$nat <- "FR"
fr.ex.data$tr_type[which(fr.ex.data$tr_type == "Instrumentale")] <- "Inst"
fr.ex.data$tr_type[which(fr.ex.data$tr_type == "Vocale")] <- "Voc"

am.ex.data <- catadata.list$expert.data[,c(1:3,6,7)]
colnames(am.ex.data) <- colnames(fr.ex.data)
am.ex.data$nat <- "AM"
am.ex.data$gen[which(am.ex.data$gen == "Male")] <- "M"
am.ex.data$gen[which(am.ex.data$gen == "Female")] <- "F"
am.ex.data$tr_type[which(am.ex.data$tr_type == "Instrumental")] <- "Inst"
am.ex.data$tr_type[which(am.ex.data$tr_type == "Vocal")] <- "Voc"

# Bind it all together
ex.data <- rbind(am.ex.data, fr.ex.data)

bygender <- as.factor(ex.data$gen)
bynationality <- as.factor(ex.data$nat)

```

```{r Q.ca, cache = TRUE}

dimcares.inf <- epCA.inference.battery(musdimdata.no6, 
                 masses= NULL, weights= NULL, 
                 hellinger = FALSE, symmetric = TRUE, 
                 graphs =FALSE, test.iters = 1000)

# Renormalize the results of CA
#RenormFi <- CARenormalization(G = dimcares.inf$Fixed.Data$ExPosition.Data$fi,
#                  delta = dimcares.inf$Fixed.Data$ExPosition.Data$pdq$Dv,
#                  singularValues = TRUE,
#                  masses = NULL)

# Factor Scores
FIsym  <- dimcares.inf$Fixed.Data$ExPosition.Data$fi
#FIasym <- RenormFi$G_A
FJs    <- dimcares.inf$Fixed.Data$ExPosition.Data$fj
CA.Q.Eigs <- dimcares.inf$Fixed.Data$ExPosition.Data$eigs
CA.Q.pEig <- dimcares.inf$Inference.Data$components$eigs.perm
```

```{r someQcolors}
# Participant colors:
col4M <- wes_palettes$Rushmore1[3]
col4F <- wes_palettes$Rushmore1[5]
col4FR <- wes_palettes$Darjeeling1[1]
col4AM <- wes_palettes$Darjeeling2[2]
# 
col4byG <- as.character(bygender)
col4byG[col4byG == "F"] <- col4F
col4byG[col4byG == "M"] <- col4M

col4byN <- as.character(bynationality)
col4byN[col4byN == "FR"] <- col4FR
col4byN[col4byN == "AM"] <- col4AM

# To account for the fact that we removed some rows above:
numberofdims[c(1,7,8,9,10)] <- c(8,7,3,4,6)
numberofdims <- numberofdims[-11]

col4cols <- wes_palette("FantasticFox1", 
                        length(numberofdims), type = "continuous")
col4cols <- rep(col4cols, numberofdims)

```

```{r bootQCA, cache=TRUE}

bootCA <- Boot4PTCA(ZeDataCube = thebrick.no6,
           fi = FIsym,
           fj = FJs,
           eigs = CA.Q.Eigs,
           nf2keep = 3,
           nBootIter = 500)
# Compute Bootstrapped ratios
bootRatios.I <- PTCA4CATA::boot.ratio.test(bootCA$RowsBoot,
                                            critical.value = 2)
bootRatios.J <- PTCA4CATA::boot.ratio.test(bootCA$ColumnsBoot,
                                              critical.value = 2)
# Probabilities 
probBR.I  <- bootRatios.I$prob.boot.ratios
probBR.J  <- bootRatios.J$prob.boot.ratios
```

```{r ca4Judges.Q}
# We have a problem here because most matrices
#  have lines with zeros. A symmetric difference matrix 
#  would do better than an RV or a 
#  chi2 distance so we use createSymDist4PTCA

Cmat.Q <- createSymDist4PTCA(thebrick)$CrossProduct

# Calculate the eigenvalues and the percentage of variance extracted (tau)
eigenCmat.Q <- eigen(Cmat.Q, symmetric = TRUE)
eig4Cmat.Q <-  eigenCmat.Q$values
tau4Cmat.Q <- round( (100*eig4Cmat.Q) / sum(eig4Cmat.Q))

# Calculate factor scores for the first three dimensions
nk       <- 3
F4Cmat.Q   <- eigenCmat.Q$vectors[,1:nk] %*% diag(eig4Cmat.Q[1:nk]^(1/2))

# Prep for plotting
Shortnames4Participants.Q <-  dimnames(thebrick[[3]])
rownames(F4Cmat.Q) <- Shortnames4Participants.Q

# Make labels
labels4RV.Q <- createxyLabels.gen(1,2,lambda = eig4Cmat.Q, tau = tau4Cmat.Q)
```

### Participants
  The scree plot below shows the eigenvalues for the distance analysis between musical experts. The usual guideline of analyzing only dimensions with eigenvalues greater than one seems prohibitive here, as all dimensions except the last have $\lambda$ > 1. For the purposes of this experiment, we've opted to focus on the first two dimensions, with $\lambda$ = `r round(eig4Cmat.Q[1], 3)` and $\lambda$ = `r round(eig4Cmat.Q[2], 3)`, respectively. This suggests that each of the participants is contributing similarly to the dimensionality of this analysis. This analysis revealed no significant difference between the experts based on any of the grouping variables used. 

```{r screeRV, fig.height = 4, fig.width = 8, fig.align='center'}
# Scree plot with significance
ScreeInf <- PlotScree(ev = eig4Cmat.Q,
                      max.ev = NULL, alpha = 0.05,
                      col.ns = "#006D2C", plotKaiser = TRUE,
                      title = "Participants Distance Analysis, Musical Qualities Survey: \nExplained Variance per Dimension")
a000.00.screeRV <-  recordPlot()
```

### Excerpts

```{r getQeigs}
dim1eigperc <- round(100*(dimcares.inf$Fixed.Data$ExPosition.Data$eigs[1]/sum(dimcares.inf$Fixed.Data$ExPosition.Data$eigs)), 2)

dim2eigperc <- round(100*(dimcares.inf$Fixed.Data$ExPosition.Data$eigs[2]/sum(dimcares.inf$Fixed.Data$ExPosition.Data$eigs)), 2)

dim3eigperc <- round(100*(dimcares.inf$Fixed.Data$ExPosition.Data$eigs[3]/sum(dimcares.inf$Fixed.Data$ExPosition.Data$eigs)), 2)
```

The scree plot for the analysis of the musical quality ratings survey (see \@ref(fig:scree4excerptsq)) shows the high dimensionality of this space, with the first three dimensions extracting a total of `r dim1eigperc`%, `r dim2eigperc`% and `r dim3eigperc`% respectively, totalling only `r sum(dim1eigperc, dim2eigperc, dim3eigperc)`% of the variance. It isn't until we get to the 11th dimension that we see >80% of the variance explained. However, given that the assumption in an analysis like this is that the sample is random, it's important to take these numbers with a grain of salt. Music of the type that was presented in this study is by definition not random; in a single excerpt, repetition is common, and some musical qualities are inextricably linked, for example some stylistic elements with genre. As such, we've opted to focus on the first two dimensions in the analysis below. 

```{r scree4excerptsq}
mus.scree <- PlotScree(dimcares.inf$Fixed.Data$ExPosition.Data$eigs, 
                       dimcares.inf$Inference.Data$components$p.vals, 
                       plotKaiser = T, color4Kaiser = "red"
                                              ) 

mus.00.scree <- recordPlot()

```

Graphing the variable loadings (see \@ref(fig:contributionsQ)) on the first two dimensions shows which musical qualities and which musical dimensions contribute the most to the first two dimensions. Because of how CA is calculated, we know that the excerpts that load on the same dimension and direction as the musical qualities are the excerpts that are most associated with those qualities. The contributions shown here are only those that contribute significantly to the first two dimensions, for a table of the complete contributions from the first four dimensions, see supplementary materials. 
  There are some obvious groups of variables, especially tempo and articulation in the first dimension, with fewer contributions from the dynamics group. The tempo variables, which are a continuum, load from high (tempo.F6 and tempo.F7) in the positive direction to low (tempo.F2 and tempo.F1) in the negative direction. Other contributions are one-off: major harmony, triple meter, classical genre, undulating contour, and disjunct motion. The excerpts that load positively, and are therefore associated with the qualities that load in the positive direction, are all from group 2: Excerpts 4, 13, 23, and 26. The ones that load in the negative direction are from mostly from group 4: Excerpts 7, 10, 24, and 27, with one from group 3, Excerpt 3.
  
  The second dimension seems to dominated by a few groups: harmony, meter, genre, dynamics. The one-offs are slow tempo, ascending contour, and "no melody". The excerpts that load significantly on this dimension are from all four groups. In the positive direction, it's Excerpts 7, 12, 15, and 27 from Group 4, and Excerpt 19 from Group 1. In the negative direction it's Excerpts 2, 3, 11, and 17. All are from group 3 except for Excerpt 2, which is from Group 2. For a full enumeration of contributions, loadings, and boostrap ratios, see table [insert table number, also, make up table.] in the supplementary materials.



```{r justsomecontsQ}

load("excerptsdesign.RData")

col4exgrp <- excerptsdesign$ex.design$col4exgrp
ex.cols <- excerptsdesign$ex.design$ex.cols

signed.ctrI <- dimcares.inf$Fixed.Data$ExPosition.Data$ci * sign(FIsym)
signed.ctrJ <- dimcares.inf$Fixed.Data$ExPosition.Data$cj * sign(FJs)

CIlist.dim <- vector(mode = "list", length = 3)
CJlist.dim <- vector(mode = "list", length= 3)

names(CIlist.dim) <- c("Dim1", "Dim2", "Dim3")
names(CJlist.dim) <- c("Dim1", "Dim2", "Dim3")

for (i in 1:3){
  CIlist.dim[[i]] <- signed.ctrI[which(abs(signed.ctrI[,i]) > 1/nrow(signed.ctrI)),i]
  CJlist.dim[[i]] <- signed.ctrJ[which(abs(signed.ctrJ[,i]) > 1/nrow(signed.ctrJ)),i]
}

col4barsQ <- vector(mode = "list", length = 6)
names(col4barsQ) <- c("IDim1", "JDim1", "IDim2", "JDim2", "IDim3", "JDim3")

nrows <- nrow(signed.ctrI)

```

```{r contributionsQ, fig.width=10}
# plot contributions of rows for component 1
ctrI.1 <- PrettyBarPlot2(CIlist.dim$Dim1,
                         threshold = 1 / NROW(signed.ctrI),
                         font.size = 3,
                         color4bar = col4exgrp[which(abs(signed.ctrI[,1]) > 1/nrow(signed.ctrI))] , # we need hex code
                         ylab = 'Contributions', #sortValues = TRUE,
                         ylim = c(1.2*min(signed.ctrI[,1]), 1.2*max(signed.ctrI[,1]))
) #+ ggtitle("Component 1", subtitle = 'Rows')

# plot contributions of columns for component 1
ctrJ.1 <- PrettyBarPlot2(CJlist.dim$Dim1,
                         threshold = 1 / NROW(signed.ctrJ),
                         font.size = 3,
                         color4bar = col4cols[which(abs(signed.ctrJ[,1]) > 1/nrow(signed.ctrJ))], # we need hex code
                         ylab = 'Contributions',
                         ylim = c(1.2*min(signed.ctrJ[,1]), 1.2*max(signed.ctrJ[,1]))
) #+ ggtitle("", subtitle = 'Columns')

# plot contributions of rows for component 2
ctrI.2 <- PrettyBarPlot2(CIlist.dim$Dim2,
                         threshold = 1 / NROW(signed.ctrI),
                         font.size = 3,
                         color4bar = col4exgrp[which(abs(signed.ctrI[,2]) > 1/nrow(signed.ctrI))] , # we need hex code
                         ylab = 'Contributions',
                         ylim = c(1.2*min(signed.ctrI[,2]), 1.2*max(signed.ctrI[,2]))
) #+ ggtitle("Component 2", subtitle = 'Rows')

# plot contributions of columns for component 2
ctrJ.2 <- PrettyBarPlot2(CJlist.dim$Dim2,
                         threshold = 1 / NROW(signed.ctrJ),
                         font.size = 3,
                         color4bar = col4cols[which(abs(signed.ctrJ[,2]) > 1/nrow(signed.ctrJ))], # we need hex code
                         ylab = 'Contributions',
                         ylim = c(1.2*min(signed.ctrJ[,2]), 1.2*max(signed.ctrJ[,2]))
)# + ggtitle("", subtitle = 'Columns')

# plot contributions of rows for component 2
ctrI.3 <- PrettyBarPlot2(CIlist.dim$Dim3,
                         threshold = 1 / NROW(signed.ctrI),
                         font.size = 3,
                         color4bar = col4exgrp[which(abs(signed.ctrI[,3]) > 1/nrow(signed.ctrI))] , # we need hex code
                         ylab = 'Contributions',
                         ylim = c(1.2*min(signed.ctrI[,3]), 1.2*max(signed.ctrI[,3]))
)# + ggtitle("Component 3", subtitle = 'Rows')

# plot contributions of columns for component 2
ctrJ.3 <- PrettyBarPlot2(CJlist.dim$Dim3,
                         threshold = 1 / NROW(signed.ctrJ),
                         font.size = 3,
                         color4bar = col4cols[which(abs(signed.ctrJ[,3]) > 1/nrow(signed.ctrJ))], # we need hex code
                         ylab = 'Contributions',
                         ylim = c(1.2*min(signed.ctrJ[,3]), 1.2*max(signed.ctrJ[,3]))
)# + ggtitle("", subtitle = 'Columns')

grid.arrange(
    as.grob(ctrI.1),as.grob(ctrJ.1),
    as.grob(ctrI.2),as.grob(ctrJ.2),
#    as.grob(ctrI.3),as.grob(ctrJ.3),
    ncol = 2,nrow = 2,
    top = textGrob("Contributions", gp = gpar(fontsize = 18, font = 3))
  )

Ctr.IJ <- recordPlot()

#1 - blue, 2 - red, 3 - green, 4 - yellow
```

### Discussion

  The graph depicted in \@ref(fig:factormapswsimplexQ) is a biplot depicting how excerpts and variables plot in the same space.  This biplot is possible because of the nature of correspondence analysis. Because the rows and columns of the contingency table X by definition have the same variance, the eigenvalues extracted from X are the same as X^T. Thus the axes on which the factor scores are plotted are the same for both the rows and the columns. However, interpretation requires some discernment. The distance between the excerpts can be interpreted directly as similarity, and the distance between the musical qualities can be interpreted directly as similarity, but the distance between a quality and an excerpt cannot. Instead, the angle between an excerpt and a quality is indicative of their correlation. An angle of 0 indicates a correlation of 1, an angle of 90 indicates a correlation of 0, and an angle of 180 indicates a correlation of -1. 
  Overall, this helps us to evaluate what contribute to the excerpt groupings. These first two dimensions suggest that the hierarchical cluster analysis [see supplementary materials] revealed groupings roughly according to genre. 
  One perceptual element that is revealed here is that tempo and dynamics seem to contribute, intensity-wise, similarly to the first dimension. The excerpts were not intentionally composed with those characteristics being similar in mind, but it's entirely possible that participants associated high or low arousal levels of the various excerpts and that turned up in the results. For example, given two excerpts of similar tempo, one may have been rated slightly faster if it was also louder, and the other slightly slower if it was quieter. Likewise, given excerpts of similar volume, a faster one may have been rated louder than a slower one. Perception of tempo is also affected by note rate, which is also tied to arousal. In two pieces played at the same tempo, the one with more notes per unit time is more likely to be judged faster than one with fewer.
  There are also a few musical elements revealed from the associations. The term staccato means short or light and separated, and the term legato means smooth and connected. The participants in this experiment didn't have access to scores, so they would be judging the excerpts aurally only. With faster excerpts, the notes by definition take up less time, and may be more likely to be judged as light and separate, regardless of what the actual articulation was. Slow tempo and legato are associated in different ways. In terms of performance practice or pedagogy, slow notes are often intended to be connected as smoothly as possible, in order to create a sense of continuity. In terms of genre and harmony, while jazz/blues (on the third dimension) is the most extreme example of this, many genres have harmonies associated with them. For example, the classical genre has fairly structured rules for both harmony and voice leading, but the romantic era relaxed those rules and introduced more complex harmonies. The gradual devolution of those rules and the increase in complexity of harmony continued through the modern and contemporary styles. Although these specific contributions aren't as strong as some of the others, a glance back at the factor scores plot shows that the older genres: baroque, classical, and romantic, are both negative on the 2nd dimension, as are the simpler harmonies of major and minor. Likewise the newer genres: impressionist, modern, and contemporary, load positively on the 2nd dimension, along with the more complex harmonies of chromatic, whole tone, and ambiguous. Historically speaking, the whole tone scale gained great popularity with composers in the impressionist era. 
  However, because of the nature of this survey, this tells us more about the excerpts specifically than the behavior of the participants. Because the excerpts were composed with the intent of varying across all of these musical dimensions, what we see is a sort of validation that there is, in fact, that variety among these excerpts, and that they are different enough to create a large and varied factor space. It also reveals intrinsic biases in the composer's writing. Two excerpts, 6 and 14, showed an outsized influence on the factor space during preliminary analyses. We determined that this was because they were the only minimalist and jazz excerpts, respectively. They were therefore removed from the analyses and projected as supplementary points. That way we are able to see how they compare to the other excerpts in this factor space without distorting it and dominating one or the other dimensions.

```{r factormapswsimplexQ, fig.height = 8, fig.show = 'hold', out.width='100%'}

axisone = 1
axistwo = 2

rownames(FIsym)<- c(1:5,7:13,15:30)
unsignedCJ <- dimcares.inf$Fixed.Data$ExPosition.Data$cj[,1:2]
signedCJ <- dimcares.inf$Fixed.Data$ExPosition.Data$cj * sign(FJs)

sig.colsonly <-  rownames(FJs)[(unsignedCJ[,1] > (1/nrow(FJs))) | 
                                 (unsignedCJ[,2] > (1/nrow(FJs))) ]

sig.FJs <- FJs[sig.colsonly,1:4]

col4sigcolsonly <- col4cols[(unsignedCJ[,1] > (1/nrow(FJs))) | 
                              (unsignedCJ[,2] > (1/nrow(FJs))) ]

mat6 <- as.matrix(catadata.list$contingency[c(6,14),])
colnames(mat6) <- colnames(catadata.list$contingency)

#test <- epCA(musdimdata.no6, 
#                  masses= NULL, weights= NULL, 
#                 hellinger = FALSE, symmetric = TRUE, 
#                 graphs =FALSE)

proj6 <- supplementaryRows(mat6, dimcares.inf$Fixed.Data)

rownames(proj6$fii) <- c("6","14")

scoresw6 <- rbind(FIsym, proj6$fii)

cols4proj <- c(col4exgrp, gplots::col2hex(c("blueviolet", "blueviolet")))

exmap.sym.12 <- createFactorMapIJ(scoresw6,
                                sig.FJs,
                                axis1 = axisone,axis2 = axistwo,
                                col.points.i = cols4proj, 
                                col.labels.i = cols4proj, 
                                col.points.j = col4sigcolsonly, 
                                col.labels.j = col4sigcolsonly,
                                text.cex.i = 4, text.cex.j = 2.5,
                                cex.i = 4, cex.j = 4,
                                font.face.i = "italic",
                                alpha.labels.i = 1, alpha.labels.j = 1
                                )

vc.labels.12 <- createxyLabels(resCA = dimcares.inf$Fixed.Data)

mus.012 <- exmap.sym.12$baseMap + #zePoly.J + 
            exmap.sym.12$I_points + 
              exmap.sym.12$I_labels + 
                exmap.sym.12$J_points + 
                  exmap.sym.12$J_labels + 
                    vc.labels.12 + ggtitle('Dimensions 1 and 2')
  
axisone = 3
axistwo = 2

exmap.sym.23 <- createFactorMapIJ(scoresw6,
                                sig.FJs,
                                axis1 = axisone,axis2 = axistwo,
                                col.points.i = cols4proj, 
                                col.labels.i = cols4proj, 
                                col.points.j = col4sigcolsonly, 
                                col.labels.j = col4sigcolsonly,
                                text.cex.i = 4, text.cex.j = 2.5,
                                font.face.i = "italic",
                                alpha.labels.i = 1, alpha.labels.j = 1
                                )

vc.labels.23 <- createxyLabels(resCA = dimcares.inf$Fixed.Data, 
                               x_axis = axisone,
                               y_axis = axistwo)

mus.023 <- exmap.sym.23$baseMap + #zePoly.J + 
            exmap.sym.23$I_points + 
              exmap.sym.23$I_labels + 
                exmap.sym.23$J_points + 
                  exmap.sym.23$J_labels + 
                    vc.labels.23 + ggtitle('Dimensions 2 and 3')


print(mus.012)
#grid.arrange(
#    as.grob(mus.012),as.grob(mus.023),
#    ncol = 2,nrow = 1,
#    top = textGrob("Symmetric Maps of the Row and Column Factor Scores", gp = gpar(fontsize = 18, font = 3))
#  )

#mus.012.023 <- recordPlot()


```




## Experiment 2: Musical Adjectives Survey

```{r Adatain}
rm(list = ls())

load("adj.catadata.list.RData")

partcols <- adj.catadata.list$partcols
adjbrick <- adj.catadata.list$adjbrick
adj.contingency <- adj.catadata.list$adjcontingency
adjcols <- adj.catadata.list$adjcols
listofwords <- adj.catadata.list$listofwords

#rows2drop <- c(6,14)
#adjbrick <- adjbrick[-rows2drop,,]
#adj.contingency <- adj.contingency[-rows2drop,]

natcols <- c(wes_palettes$Darjeeling2[2],wes_palettes$Darjeeling1[1])
nat.factor <- partcols$nationality
col4nat <- nat.factor
col4nat[col4nat == "AM"] <- natcols[1]
col4nat[col4nat == "FR"] <- natcols[2]
nat.factor <- as.factor(nat.factor)

train.factor <- as.double(partcols$tr_yrs)
train.factor[train.factor < 2] <- "Tr.none"
train.factor[train.factor >= 2 & train.factor <= 5] <- "Tr.little"
train.factor[train.factor != "Tr.none" & train.factor != "Tr.little"] <- "Tr.some"

traincols <- c(wes_palettes$Chevalier1[1], 
               wes_palettes$Darjeeling2[2], 
               wes_palettes$Darjeeling1[1])
col4train <- train.factor
col4train[col4train == "Tr.none"] <- traincols[1]
col4train[col4train == "Tr.little"] <- traincols[2]
col4train[col4train == "Tr.some"] <- traincols[3]
train.factor <- as.factor(train.factor)

gen.factor <- partcols$gender
gen.factor[gen.factor != "Female" & gen.factor != "Male" 
           & gen.factor != "Femme" & gen.factor != "Homme"] <- "NB"
gen.factor[gen.factor == "Female" | gen.factor == "Femme"] <- "F"
gen.factor[gen.factor == "Male" | gen.factor == "Homme"] <- "M"

gencols <- wes_palette("GrandBudapest1", n = 3, type = "discrete")
col4gen <- gen.factor
col4gen[col4gen == "M"] <- gencols[1]
col4gen[col4gen == "F"] <- gencols[2]
col4gen[col4gen == "NB"] <- gencols[3]
gen.factor <- as.factor(gen.factor)

col4adjs <- wes_palette("Zissou1", n = length(listofwords), type = "continuous")
# From Musical Dimensions.Rmd
load("excerptsdesign.RData")
load("adjdesign.RData")
#col4excerpts <- excerptsdesign$ex.design$col4exgrp
#ex.cols <- excerptsdesign$ex.design$ex.cols

#col4excerpts <- excerptsdesign$ex.design.w6$col4exgrp
#ex.cols <- excerptsdesign$ex.design.w6$ex.cols

col4excerpts <- adj.design$ex.cols
ex.cols <- adj.design$col4exgrp




cols <- list("g.gc" = gencols,
             "g.oc" = col4gen,
             "t.gc" = traincols,
             "t.oc" = col4train,
             "adj.cols" = col4adjs,
             "ex.gc" = ex.cols,
             "ex.oc" = col4excerpts,
             "n.gc" = natcols,
             "n.oc" = col4nat
             )
```

```{r A.CA}
adjsym.cares <- epCA(adj.contingency, 
                     symmetric = TRUE)

adjrenorm <- CARenormalization(adjsym.cares$ExPosition.Data$fi,
                               delta = adjsym.cares$ExPosition.Data$pdq$Dv,
                               singularValues = T,
                               masses = adjsym.cares$ExPosition.Data$M
                               )

FIsym.adj <- adjsym.cares$ExPosition.Data$fi
FIasym.adj <- adjrenorm$G_A
FJs.adj <- adjsym.cares$ExPosition.Data$fj
CAEigs.adj <- adjsym.cares$ExPosition.Data$eigs
```

```{r inferences.A, cache = TRUE}
# Bootstrapping
bootCA.adj <- Boot4PTCA(ZeDataCube = adjbrick,
                        fi = FIsym.adj,
                        fj = FJs.adj,
                        eigs = CAEigs.adj,
                        nf2keep = 3,
                        nBootIter = 500)
# Compute Bootstrapped ratios
bootRatadj.I <- PTCA4CATA::boot.ratio.test(bootCA.adj$RowsBoot,
                                            critical.value = 2)
bootRatadj.J <- PTCA4CATA::boot.ratio.test(bootCA.adj$ColumnsBoot,
                                              critical.value = 2)
# Probabilities 
probBRadj.I  <- bootRatadj.I$prob.boot.ratios
probBRadj.J  <- bootRatadj.J$prob.boot.ratios

# Permutation tests
adjca.inf <- perm4PTCA(aCube = adjbrick,
                       nIter = 1000,
                       permType = 'byRows' ,
                       Malinvaud = TRUE)
Ind.Permu.adj    <- adjca.inf$permInertia
InertiaFixed.adj <- adjca.inf$fixedInertia
prob.cpt.lst.adj <- adjca.inf$MalinvaudQ['p-perm',]
# Get the p values for the components
prob.cpt.adj <- (unlist(prob.cpt.lst.adj[2:length(prob.cpt.lst.adj)]))
prob.cpt.adj[is.na(prob.cpt.adj)] <- 1
```

```{r partdistance.A}

Cmat.adj <- createSymDist4PTCA(adjbrick)$CrossProduct

eigenCmat.adj <- eigen(Cmat.adj, symmetric = TRUE)
eig4Cmat.adj <-  eigenCmat.adj$values
tau4Cmat.adj <- round( (100*eig4Cmat.adj) / sum(eig4Cmat.adj))

nk       <- 3
F4Cmat.adj   <- eigenCmat.adj$vectors[,1:nk] %*% diag(eig4Cmat.adj[1:nk]^(1/2))

rownames(F4Cmat.adj) <- rownames(Cmat.adj)
```

### Participants

The scree plot below shows the explained variance per dimension for the distance analysis of participants in the adjectives survey. Again, having a high number of participants means that the dimensionality is high, and each dimension is only extracting a little bit of variance. However, the first five dimensions all have $\lambda$ > 1: `r round(eig4Cmat.adj[1], 2)`, `r round(eig4Cmat.adj[2], 2)`, `r round(eig4Cmat.adj[3], 2)`, `r round(eig4Cmat.adj[4], 2)`, and `r round(eig4Cmat.adj[5], 2)`, respectively. However, because of the high dimensionality here, the first dimension extracts approximately 3% of the overall variance, the second dimension extracts approximately 2%, and each successive dimension extracts incrementally less. 

```{r}
ScreeInf <- PlotScree(ev = eig4Cmat.adj,
             max.ev = NULL, alpha = 0.05,
             col.ns = "#006D2C", col.sig = "#54278F",
             title = "Participants Distance Analysis, Adjectives Survey: \nExplained Variance per Dimension",
             plotKaiser = T)

a000.adj.screeRV <-  recordPlot()
```  
  
Additionally, this analysis revealed a significant group differences between French and American participants in how they described the excerpts, $\textit p$. < .01. This analysis was performed using a distance matrix calculated from the pages of the brick. We calculated a double-centered cross product symmetric distance matrix from the pages of the brick and calculated the factor scores for each participant by calculating the dot product of the eigenvectors and the singular values of that symmetric distance matrix. The factor scores of the participants are plotted below, with with group means and bootstrapped confidence intervals shown for those means. The bootstrapping resampling was performed with 1000 iterations.


```{r map4RV.A, fig.height=8}
Shortnames4Participants <-  dimnames(adjbrick[[3]])
F4Plot <- F4Cmat.adj
rownames(F4Plot) <- Shortnames4Participants
# Make labels
labels4RV <- createxyLabels.gen(1,2,lambda = eig4Cmat.adj, tau = tau4Cmat.adj)

#Here we calculate the means for the factor groupings, and then bootstrap them:
n.adjmeans <- getMeans(F4Plot, nat.factor)
BootCadj.N <- PTCA4CATA::Boot4Mean(F4Cmat.adj, design = nat.factor,
                                   niter = 1000,
                                   suppressProgressBar = TRUE)
dimnames(BootCadj.N$BootCube)[[2]] <- paste0('Dimension ',
                                             1:dim(BootCadj.N$BootCube)[[2]])
# Create ellipses for the map
n.elliadj <- MakeCIEllipses(BootCadj.N$BootCube[,1:2,],
                            names.of.factors = c("Dimension 1", "Dimension 2"),
                            col = cols$n.gc)
#Base map
BaseMap.Participants <- createFactorMap(X = F4Plot ,
                              axis1 = 1, axis2 = 2,
                              display.points = TRUE,
                              col.points = cols$n.oc,
                              pch = 19, cex = 2.5,
                              display.labels = TRUE,
                              col.labels = cols$n.oc,
                              text.cex = 4, font.face = "bold",
                              font.family = "sans",
                              col.axes = "darkorchid", 
                              alpha.points = .25,
                              alpha.axes = 0.2,
                              width.axes = 1.1,
                              col.background = adjustcolor("lavender",
                                                       alpha.f = 0.2),
                              force = 1, segment.size = 3)

#Nationality map
title4RV <- "Rv Analysis of Participants \nIncluding Group Means and Confidence Intervals"
n.rv.means <- createFactorMap(n.adjmeans,
                              axis1 = 1, axis2 = 2, 
                              constraints = BaseMap.Participants$constraints, 
                              col.points =  cols$n.gc,
                              alpha.points = 1, # no transparency
                              alpha.labels = 1,
                              display.points = TRUE,
                              pch = 17, cex = 5,
                              display.labels = TRUE, 
                              title = title4RV,
                              col.labels = cols$n.gc, 
                              text.cex = 6,font.face = "bold",
                              font.family = "sans", col.axes = "darkorchid", 
                              alpha.axes = 0.2, width.axes = 1.1, 
                              col.background = adjustcolor("lavender", alpha.f = 0.2), 
                              force = 1, segment.size = 0)

a.03adj.map4part <- BaseMap.Participants$zeMap_background + 
                  n.rv.means$zeMap_text + n.rv.means$zeMap_dots +
                    BaseMap.Participants$zeMap_dots + n.elliadj + labels4RV


print(a.03adj.map4part + ggtitle(title4RV))
```


### Excerpts

```{r}
adj.tau <- adjsym.cares$ExPosition.Data$t
```

  The plot below shows the explained variance per dimension in the analysis of the excerpts contingency table. Although there are no components with $\lambda$ > 1, there are two strong dimensions that extract a majority of the variance. The first two dimensions extract `r round(sum(adj.tau[c(1,2)]), 2)`% of the variance, with the first dimension extracting a majority: `r round(adj.tau[1]), 2)`%, and the second dimension extracting almost a quarter of the overall variance: `r round(adj.tau[1]),2)`%. This plot also suggests that there are multiple 'elbows', at the 3rd, 5th, and 7th dimensions, respectively, with the third and fourth dimensions forming an 'eigen-plane', of two dimensions which extract similar amounts of variance and should be considered together. For this analysis, however, we're focused on the two first dimensions.
  Although excerpts 6 and 14 are outliers in the musical qualities survey, for reasons detailed above, they were not outliers in this analysis. We therefore included them in all of the analyses for Experiment 2.
```{r scree4descriptors}
adj.scree <- PlotScree(adjsym.cares$ExPosition.Data$eigs, 
                       p.ev = adjca.inf$pEigenvalues,
                       plotKaiser = T, color4Kaiser = "red")
  
mus.00.scree <- recordPlot()
```

  Contributing significantly to the positive end of the first dimension are excerpts from group three (green) and to the negative end are excerpts from group one (yellow). Strong contributions on the positive end of the dimension from the adjectives "Sad", "Dark", "Melancholy", "Slow", "Mysterious", "Solemn", and "Disturbing". The negative end of the first dimension is defined by the adjectives "Fast", "Happy", "Dancing", "Colorful", and "Bright". 
  The second dimension is dominated by excerpts from group 4 (red) in the positive direction and group 2 (blue) in the negative direction. Two excerpts from group 3 also contribute significantly, excerpts 7 in the positive direction and excerpt 10 in the negative direction. The columns contributing strongly in the positive direction are "Aggressive", "Fast", "Disturbing", "Mysterious", "Surprising" and "Complex". The columns contributing in the negative direction are "Warm, "Soft", "Happy", "Slow", "Round", and "Light". A table showing the full enumeration of all contributions 

```{r justsomeconts.A}

signed.ctrI.adj <- adjsym.cares$ExPosition.Data$ci * sign(FIsym.adj)
signed.ctrJ.adj <- adjsym.cares$ExPosition.Data$cj * sign(FJs.adj)

CIlist <- vector(mode = "list", length = 2)
CJlist <- vector(mode = "list", length= 2)

names(CIlist) <- c("Dim1", "Dim2")
names(CJlist) <- c("Dim1", "Dim2")

for (i in 1:3){
  CIlist[[i]] <- signed.ctrI.adj[which(abs(signed.ctrI.adj[,i]) > 1/nrow(signed.ctrI.adj)),i]
  CJlist[[i]] <- signed.ctrJ.adj[which(abs(signed.ctrJ.adj[,i]) > 1/nrow(signed.ctrJ.adj)),i]
}
```

```{r contributions.A}
# plot contributions of rows for component 1
ctradjI.1 <- PrettyBarPlot2(CIlist[[1]],
                         threshold = 1 / NROW(signed.ctrI.adj),
                         font.size = 3,
                         color4bar = cols$ex.oc[which(abs(signed.ctrI.adj[,1]) > 1/nrow(signed.ctrI.adj))], # we need hex code
                         ylab = 'Contributions',
                         #sortValues = TRUE,
                         ylim = c(1.2*min(CIlist[[1]]), 1.2*max(CIlist[[1]]))
) + ggtitle("Component 1", subtitle = 'Rows')

# plot contributions of columns for component 1
ctradjJ.1 <- PrettyBarPlot2(CJlist$Dim1,
                         threshold = 1 / NROW(signed.ctrJ.adj),
                         font.size = 3,
                         color4bar = cols$adj.cols[which(abs(signed.ctrJ.adj[,1]) > 1/nrow(signed.ctrJ.adj))], # we need hex code
                         ylab = 'Contributions',
                        # sortValues = TRUE,
                         ylim = c(1.2*min(CJlist[[1]]), 1.2*max(CJlist[[1]]))
) + ggtitle("", subtitle = 'Columns')

# plot contributions of rows for component 2
ctradjI.2 <- PrettyBarPlot2(CIlist[[2]],
                         threshold = 1 / NROW(signed.ctrI.adj),
                         font.size = 3,
                         color4bar = cols$ex.oc[which(abs(signed.ctrI.adj[,2]) > 1/nrow(signed.ctrI.adj))], # we need hex code
                         ylab = 'Contributions',
                        # sortValues = TRUE,
                         ylim = c(1.2*min(signed.ctrI.adj[,2]), 1.2*max(signed.ctrI.adj[,2]))
) + ggtitle("Component 2", subtitle = 'Rows')

# plot contributions of columns for component 2
ctradjJ.2 <- PrettyBarPlot2(CJlist$Dim2,
                         threshold = 1 / NROW(signed.ctrJ.adj),
                         font.size = 3,
                         color4bar = cols$adj.cols[which(abs(signed.ctrJ.adj[,2]) > 1/nrow(signed.ctrJ.adj))], # we need hex code
                         ylab = 'Contributions',
                        # sortValues = TRUE,
                         ylim = c(1.2*min(signed.ctrJ.adj[,2]), 1.2*max(signed.ctrJ.adj[,2]))
) + ggtitle("", subtitle = 'Columns')

grid.arrange(
    as.grob(ctradjI.1),as.grob(ctradjJ.1),
    as.grob(ctradjI.2),as.grob(ctradjJ.2),
    ncol = 2,nrow = 2,
    top = textGrob("Contributions", gp = gpar(fontsize = 18, font = 3))
  )

Ctradj.IJ <- recordPlot()

#yellow is 1, blue is 2, green is 3, red is 4.

```


### Discussion
  
  The factor maps below show the row and column factor scores for the american and french participants. These are once again symmetric plots, interpretation is the same as the factor plot for the musical qualities. There's a clear valence-arousal plane apparent for both, and in both cases valence seems to define the first dimension and arousal defines the second dimension. However, the difference in the amount of variance extracted by the first two dimensions between the french and american participants is notable. The french data show a weaker first dimension but a stronger second dimension relative to the americans, both in terms of variance extracted (tau), effect size (lambda). 
  
  There are also differences in how the adjectives and the excerpts are distributed in the space. One clear example is that Excerpt 6 is in quadrant four in the american plot, but quadrant one in the french. This is a small change, but it suggests that the french participants were more likely to assign negative valence to this excerpt, and American Participants were more likely to assign positive valence. For the adjectives, 'bright' and 'dancing' are directly on top of one another in the American plot, but there is some space between the two in the French plot.  It's possible that this reflects the idea that although the meaning is shared between languages, there are semantic or associational differences between the words.


```{r factormapswsimplex.A, fig.height = 10, fig.show = 'hold', out.width='100%'}

adjbrick.AM <- adjbrick[,,1:length(which(adj.catadata.list$partcols$nationality == "AM"))]
adj.cont.AM <- apply(adjbrick.AM, c(1,2), sum)

adjbrick.FR <- adjbrick[,,(length(which(adj.catadata.list$partcols$nationality == "AM"))+1):dim(adjbrick)[[3]]]
adj.cont.FR <- apply(adjbrick.FR, c(1,2), sum)

adj.fr.cares <- epCA(adj.cont.FR, symmetric = TRUE)
adj.am.cares <- epCA(adj.cont.AM, symmetric = TRUE)

adj.fr.cares$ExPosition.Data$fi[,2] <- adj.fr.cares$ExPosition.Data$fi[,2]*-1
adj.fr.cares$ExPosition.Data$fj[,2] <- adj.fr.cares$ExPosition.Data$fj[,2]*-1

am.FI <- adj.am.cares$ExPosition.Data$fi
am.FJ <- adj.am.cares$ExPosition.Data$fj

fr.FI <- adj.fr.cares$ExPosition.Data$fi
fr.FJ <- adj.fr.cares$ExPosition.Data$fj


rownames(am.FI) <- rownames(fr.FI) <- c(1:30)


colnames(adjrenorm$G_A) <- colnames(FJs.adj)

axisone <- 1
axistwo <- 2

exmap.asym <- createFactorMapIJ(adjrenorm$G_A,
                                FJs.adj,
                                axis1 = axisone,axis2 = axistwo,
                                col.points.i = cols$ex.oc, 
                                col.labels.i = cols$ex.oc, 
                                col.points.j = cols$adj.cols, 
                                col.labels.j = cols$adj.cols,
                                text.cex.i = 3.5, text.cex.j = 3.5
                                )

# It's a fairly complex simplex, so we specify the vertices between which the
# simplex should be drawn.

excerptedges <- c("Fast", "Aggressive", "Disturbing", "Dark", "Sad", 
                  "Slow", "Soft", "Warm", "Happy")

simplexorder <- match(excerptedges, colnames(adj.contingency))

zePoly.J <- PTCA4CATA::ggdrawPolygon(FJs.adj, order2draw = simplexorder)

vc.labels <- createxyLabels(resCA = adjsym.cares)

am.labels <- createxyLabels(resCA = adj.am.cares)

fr.labels <- createxyLabels(resCA = adj.fr.cares)

exmap.am <- createFactorMapIJ(am.FI,
                                am.FJ,
                                axis1 = axisone,axis2 = axistwo,
                                col.points.i = cols$ex.oc, 
                                col.labels.i = cols$ex.oc, 
                                col.points.j = cols$adj.oc, 
                                col.labels.j = cols$adj.oc,
                                text.cex.i = 5, text.cex.j = 3.5, font.face.j = 'italic'
                                
                                )



exmap.fr <- createFactorMapIJ(fr.FI,
                                fr.FJ,
                                axis1 = axisone,axis2 = axistwo,
                                col.points.i = cols$ex.oc, 
                                col.labels.i = cols$ex.oc, 
                                col.points.j = cols$adj.oc, 
                                col.labels.j = cols$adj.oc,
                                text.cex.i = 5, text.cex.j = 3.5, font.face.j = 'italic'
                                )


mus.adj.am <- exmap.am$baseMap + 
            exmap.am$I_points + 
              exmap.am$I_labels + 
                exmap.am$J_points + 
                  exmap.am$J_labels + 
                    am.labels + ggtitle('American Participants')

mus.adj.fr <- exmap.fr$baseMap +  
            exmap.fr$I_points + 
              exmap.fr$I_labels + 
                exmap.fr$J_points + 
                  exmap.fr$J_labels + 
                    fr.labels + ggtitle('French Participants')

mus.adj.004 <- exmap.asym$baseMap + zePoly.J + 
            exmap.asym$I_points + 
              exmap.asym$I_labels + 
                exmap.asym$J_points + 
                  exmap.asym$J_labels + 
                    vc.labels + ggtitle('Asymmetric Map with Simplex')
  

grid.arrange(
    as.grob(mus.adj.am),as.grob(mus.adj.fr),
    ncol = 2,nrow = 1, 
    top = textGrob("Symmetric Maps of the Row and Column Factor Scores", gp = gpar(fontsize = 18, font = 3))
 )

am_fr_adjmaps <- recordPlot()


#print(mus.adj.004)
```

## Experiment 3: Combined Surveys

```{r loadthedataPLSC}
rm(list = ls())

load("catadatamusdim.RData")
load("adj.catadata.list.RData")
load("adjdesign.RData")

dimcontingency <- catadata.list$contingency
adjcontingency <- adj.catadata.list$adjcontingency

dimcontingency <- dimcontingency[-c(6,14),-9]
adjcontingency <- adjcontingency[-c(6,14),]

```

```{r}
library(TExPosition)
library(TInPosition)
library(data4PCCAR)
pls.res <- tepPLS(dimcontingency, adjcontingency, DESIGN = adj.design$thedesign[-c(6,14)])
resPerm4PLSC <- perm4PLSC(dimcontingency, adjcontingency, nIter = 1000)

```

```{r thefirst3eigs}

e1 <- pls.res$TExPosition.Data$eigs[1]
e2 <- pls.res$TExPosition.Data$eigs[2]
e3 <- pls.res$TExPosition.Data$eigs[3]

t1 <- pls.res$TExPosition.Data$t[1]
t2 <- pls.res$TExPosition.Data$t[2]
t3 <- pls.res$TExPosition.Data$t[3]
t4 <- pls.res$TExPosition.Data$t[4]

```

The final analysis revealed two dimensions that extracted the majority of the variance (`r round(sum(t1,t2), 2)`%). Of that total extracted by the first two dimensions, the first dimension extracted `r round(t1, 2)`% and the second dimension extracted `r round(t2, 2)`%. The scree plot below shows that it's possible that there are two elbows in this graph, at the 3rd and 5th dimensions. The 3rd and 4th dimensions are also significant, extracting `r round(t3, 2)`% and `r round(t4, 2)`% of the variance, respectively. 

```{r screePLSC}

PlotScree(ev = pls.res$TExPosition.Data$eigs,
          p.ev = resPerm4PLSC$pEigenvalues,
          title = 'PLSC Music Features: Inertia Scree Plot',
          plotKaiser = TRUE, 
          color4Kaiser = ggplot2::alpha('darkorchid4', .5),
          lwd4Kaiser  = 2
          )
a000.scree4plsc <-  recordPlot()

```

The plot below shows which variables from each data table load the most on the first and second dimensions. For the purposes of this visualization, we are showing only the variables for which 70% or more of the variance is explained. The nature of the PLSC also suggests that these are the variables that are most associated with one another between the two tables. The strongest signal on the first dimension juxtaposes the slow and legato musical qualities in the positive direction with the fast, staccato, marcato, and conjunct musical qualities in the negative direction. The adjectives associated with the qualities in the positive direction are "Dark", "Dull", "Long", "Melancholy", "Sad", "Slow", "Solemn", and "Weak." The adjectives associated with the negative direction are "Bright", "Colorful", "Dancing", "Fast", "Happy", and "Light".
The second dimension identified in the positive direction major harmony and mezzo dynamics, associated with "Light", "Round", "Soft", and "Warm." The negative direction is driven by the impressionist genre being associated with "Aggressive", "Complex", "Dense", "Disturbing", "Powerful", and "Surprising".

# Include contributions?

```{r loadings_barplotsplsc, fig.width = 12, fig.height = 4, fig.show='hold', message=F}

ps <- pls.res$TExPosition.Data$pdq$p
qs <- pls.res$TExPosition.Data$pdq$q

th <- .7

pslist <- vector(mode = "list", length = 2)
qslist <- vector(mode = "list", length= 2)

names(qslist) <- c("Dim1", "Dim2")
names(pslist) <- c("Dim1", "Dim2")

p.names <- rownames(ps)
q.names <- rownames(qs)

for (i in 1:2){
  pslist[[i]] <- ps[which(abs(ps[,i]) > th*max(abs(ps[,i]))),i]
  qslist[[i]] <- qs[which(abs(qs[,i]) > th*max(abs(qs[,i]))),i]
  names(pslist[[i]]) <- p.names[abs(ps[,i]) > th*max(abs(ps[,i]))]
  names(qslist[[i]]) <- q.names[abs(qs[,i]) > th*max(abs(qs[,i]))]
  }

colors4plsc <- vector(mode = "list", length = 5)
names(colors4plsc) <- c("colors", "p.all","q.all","p.vec", "q.vec" )

colors4plsc$colors <- c(wes_palettes$Darjeeling1[c(1,2,4)],
                        wes_palettes$Darjeeling2[2])

colors4plsc$p.all <- ps
colors4plsc$p.all[colors4plsc$p.all > 0] <- colors4plsc$colors[1]
colors4plsc$p.all[colors4plsc$p.all != colors4plsc$colors[1]] <- colors4plsc$colors[2]

colors4plsc$q.all <- qs
colors4plsc$q.all[colors4plsc$q.all > 0] <- colors4plsc$colors[3]
colors4plsc$q.all[colors4plsc$q.all != colors4plsc$colors[3]] <- colors4plsc$colors[4]

colors4plsc$p.vec <- vector(mode = "list", length = 2)
colors4plsc$q.vec <- vector(mode = "list", length = 2)

names(colors4plsc$p.vec) <- c("Dim1", "Dim2")
names(colors4plsc$q.vec) <- c("Dim1", "Dim2")


for (i in 1:2){
  colors4plsc$p.vec[[i]] <- colors4plsc$p.all[which(abs(ps[,i]) > th*max(abs(ps[,i]))),i]
  colors4plsc$q.vec[[i]] <- colors4plsc$q.all[which(abs(qs[,i]) > th*max(abs(qs[,i]))),i]

}

loading1 <- PrettyBarPlot2(bootratio = c(pslist$Dim1, qslist$Dim1), 
                       threshold = min(c(th*max(abs(ps[,1])), th*max(abs(qs[,1])))), 
                       ylim = c(1.2*min(c(pslist$Dim1, qslist$Dim1)), 1.2*max(c(pslist$Dim1, qslist$Dim1))),
                       color4bar = c(colors4plsc$p.vec$Dim1, colors4plsc$q.vec$Dim1),
                       color4ns = "gray75", 
                       plotnames = TRUE, 
                       main = 'Loadings for variables for factor plot 1', 
                       ylab = "Signed Loadings"
                       #font.size = 1
                       )
  
loading2 <- PrettyBarPlot2(bootratio = c(pslist$Dim2, qslist$Dim2), 
                       threshold = min(c(th*max(abs(ps[,2])), th*max(abs(qs[,2])))), 
                       ylim = c(1.2*min(c(pslist$Dim2, qslist$Dim2)), 1.2*max(c(pslist$Dim2, qslist$Dim2))),
                       color4bar = c(colors4plsc$p.vec$Dim2, colors4plsc$q.vec$Dim2),
                       color4ns = "gray75", 
                       plotnames = TRUE, 
                       main = 'Loadings for variables for factor plot 2', 
                       ylab = "Signed Loadings",
                       #font.size = 1
                       )  
  

loads <- grid.arrange(
                      as.grob(loading1),
                      as.grob(loading2),
                      ncol = 2,nrow = 1
                      )

```

```{r conts_barplotsplsc, fig.width = 8, fig.height = 6, fig.show='hold', message=F}

ctri <- pls.res$TExPosition.Data$ci*sign(pls.res$TExPosition.Data$fi)
ctrj <- pls.res$TExPosition.Data$cj * sign(pls.res$TExPosition.Data$fj)

conts.sigonly <- barplot.sigonly(x = ctri,
                                 y = ctrj,
                                 th = "mean",
                                 type = "cont")


contribution1 <- PrettyBarPlot2(bootratio = conts.sigonly$data$Dim1, 
                       threshold = conts.sigonly$t.hold$thr.tog, 
                       ylim = conts.sigonly$data$y.limits$ylims.tog$Dim1,
                       color4bar = c(conts.sigonly$color$x.vec$Dim1, conts.sigonly$color$y.vec$Dim1),
                       color4ns = "gray75", 
                       plotnames = TRUE, 
                       main = 'Contributions to the First Latent Variables', 
                       ylab = "Signed Contributions"
                       #font.size = 1
                       )
  
contribution2 <- PrettyBarPlot2(bootratio = conts.sigonly$data$Dim2, 
                       threshold = conts.sigonly$t.hold$thr.tog, 
                       ylim =conts.sigonly$data$y.limits$ylims.tog$Dim2,
                       color4bar = c(conts.sigonly$color$x.vec$Dim2, conts.sigonly$color$y.vec$Dim2),
                       color4ns = "gray75", 
                       plotnames = TRUE, 
                       main = 'Contributions to the Second Latent Variables', 
                       ylab = "Signed Contributions",
                       #font.size = 1
                       )  

contributionsplot <- grid.arrange(
                      as.grob(contribution1),
                      as.grob(contribution2),
                      ncol = 1,nrow = 2
                      )


```


The factor score plots for these show that the first two latent variables extracted by the analysis effectively separate the groups of excerpts. This factor plot shows us how the strongest correlated signal between the two data tables separates Excerpts groups 2 and 3, but groups 1 and two didn't contribute much to this dimension, instead contributing to the 2nd latent variables. The second strongest signal separates Groups 1 and 4, with Groups 2 and 3 more barycentric.

```{r factorplotsPLSC, fig.width = 12, fig.height = 6}
latvar.1 <- cbind(pls.res$TExPosition.Data$lx[,1],pls.res$TExPosition.Data$ly[,1])
colnames(latvar.1) <- c("Lx 1", "Ly 1")

zedesign <- adj.design$thedesign[-c(6,14)]
lescoleurs <- adj.design$ex.cols[-c(6,14)]
coleur4group <- adj.design$col4exgrp


# compute means
lv.1.group <- getMeans(latvar.1, zedesign)

# get bootstrap intervals of groups
lv.1.group.boot <- Boot4Mean(latvar.1, zedesign)
colnames(lv.1.group.boot$BootCube) <- c("Lx 1", "Ly 1")

#Next, we can start plotting:

plot.lv1 <- createFactorMap(latvar.1,
                         col.points = lescoleurs,
                         col.labels = lescoleurs,
                         alpha.points = 0.4, alpha.labels = 0.4,
                         text.cex = 3, title = "Latent Variable Plot 1"
                         )

plot1.mean <- createFactorMap(lv.1.group,
                              col.points = coleur4group,
                              col.labels = coleur4group,
                              cex = 4,
                              pch = 17,
                              alpha.points = 0.8, 
                              text.cex = 6)

plot1.meanCI <- MakeCIEllipses(lv.1.group.boot$BootCube[,c(1:2),], # get the first two components
                              col = adj.design$col4exgrp,
                              names.of.factors = c("Lx 1", "Ly 1")
                              )

plot1 <- plot.lv1$zeMap_background + plot.lv1$zeMap_dots + plot.lv1$zeMap_text +
           plot1.mean$zeMap_text + plot1.meanCI


latvar.2 <- cbind(pls.res$TExPosition.Data$lx[,2],pls.res$TExPosition.Data$ly[,2])
colnames(latvar.2) <- c("Lx 2", "Ly 2")

# compute means
lv.2.group <- getMeans(latvar.2, zedesign)

# get bootstrap intervals of groups
lv.2.group.boot <- Boot4Mean(latvar.2, zedesign)
colnames(lv.2.group.boot$BootCube) <- c("Lx 2", "Ly 2")

#Next, we can start plotting:

plot.lv2 <- createFactorMap(latvar.2,
                         col.points = lescoleurs,
                         col.labels = lescoleurs,
                         alpha.points = 0.4, alpha.labels = 0.4,
                         text.cex = 3, title = "Latent Variable Plot 2"
                         )

plot2.mean <- createFactorMap(lv.2.group,
                              col.points = coleur4group,
                              col.labels = coleur4group,
                              cex = 4,
                              pch = 17,
                              alpha.points = 0.8, 
                              text.cex = 6)

plot2.meanCI <- MakeCIEllipses(lv.2.group.boot$BootCube[,c(1:2),], # get the first two components
                              col = coleur4group,
                              names.of.factors = c("Lx 2", "Ly 2")
                              )

plot2 <- plot.lv2$zeMap_background + plot.lv2$zeMap_dots + plot.lv2$zeMap_text +
           plot2.mean$zeMap_text + plot2.meanCI


plsc.fplot <- grid.arrange(
                      as.grob(plot1),
                      as.grob(plot2),
                      ncol = 2,nrow = 1
                      )

```


# Discussion

Although this study was designed to evaluate the sensory or cognitive response to music, and not specifically the emotional response, there is significant overlap in the results observed here and the results of the work investigating musica and emotion. 

- Because of the nature of the CA, the musical qualities survey is not robust to outliers.
- hierarchical clustering revealed that there are differences in groupings between the musical qualities and the adjectives judgments.
- valence/arousal model is very clear in the adjectives data
- which qualities dominate which dimensions in the musical qualities survey? Why? Is it because of clear subjective/objective agreement on some specific musical qualities?


## Limitations & future directions
- continue to evaluate more participants from more varying backgrounds
- increase sample size between highly trained musicians and others
- add more dimensions (melodic complexity)


\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
